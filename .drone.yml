---
kind: pipeline
type: kubernetes
name: preview
steps:

- name: submodules
  image: alpine/git
  commands:
  - git submodule update --init --recursive

- name: build
  image: peaceiris/hugo:latest-full
  commands: 
    - npm install 
    - hugo -D -b "https://blog.xllb.cc:8443" --enableGitInfo --config config-preview.toml

- name: deploy
  image: drillster/drone-rsync
  settings:
    hosts: 
      - 10.0.5.3
    source: ./public
    target: ~/packages
    args: -p 1022
    key:
    user: eindex

trigger:
  target:
    - preview

---
kind: pipeline
type: kubernetes
name: release
steps:

- name: submodules
  image: alpine/git
  commands:
  - git submodule update --init --recursive

- name: build
  image: peaceiris/hugo:latest-full
  commands: 
    - npm install 
    - hugo -b "https://eindex.me" --minify --enableGitInfo --config config.toml

trigger:
  event: 
    - promote
  target:
    - prod


---
kind: pipeline
type: kubernetes
name: ipfs-release
steps:

- name: submodules
  image: alpine/git
  commands:
  - git submodule update --init --recursive

- name: build
  image: peaceiris/hugo:latest-full
  commands: 
    - npm install 
    - hugo --minify --enableGitInfo --config config-ipfs.toml

trigger:
  event: 
    - promote
  target:
    - ipfs
