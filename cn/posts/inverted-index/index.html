<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.ico">
    <meta name="generator" content="Astro v2.1.3">
    <title>倒排索引</title>
    <link rel="webmention" href="https://webmention.io/eindex.me/webmention">
    <link rel="pingback" href="https://webmention.io/eindex.me/xmlrpc">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/lxgwwenkai-regular.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="/katex.min.css" crossorigin="anonymous">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SR36ZS0R52"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-SR36ZS0R52");
</script>
  <link rel="stylesheet" href="/_astro/gallery.bc4fe863.css" />
<link rel="stylesheet" href="/_astro/_slug_.eda67c97.css" />
<link rel="stylesheet" href="/_astro/_slug_.8c5018de.css" />
<link rel="stylesheet" href="/_astro/_slug_.9be3c881.css" />
<link rel="stylesheet" href="/_astro/_slug_.fe6782dc.css" /><script type="module">class o extends HTMLElement{constructor(){super();const e=this.querySelector("button"),t=this.querySelector("div.code-body");e.addEventListener("click",()=>{navigator.clipboard.writeText(t.innerText).then(()=>{console.log("copy successd")})})}}customElements.define("article-code",o);
</script></head>
  <body>
    <nav class="astro-5BLMO7YK">
  <span class="astro-5BLMO7YK"><img width="32px" height="32px" src="/images/avatar.png" class="astro-5BLMO7YK"><a href="/" class="astro-5BLMO7YK"><b class="astro-5BLMO7YK">EINDEX</b>'s Blog</a></span>
  <ul class="astro-5BLMO7YK">
    <li class="astro-5BLMO7YK">
          <a href="/" class="astro-5BLMO7YK">Home</a>
        </li><li class="astro-5BLMO7YK">
          <a href="/cn/posts" class="astro-5BLMO7YK">中文博客</a>
        </li><li class="astro-5BLMO7YK">
          <a href="/posts" class="astro-5BLMO7YK">Posts</a>
        </li><li class="astro-5BLMO7YK">
          <a href="/gallery" class="astro-5BLMO7YK">Gallery</a>
        </li>
  </ul>
</nav><div class="blog astro-SCKKX6R4">
    <article class="h-entry astro-WMBV4WGB">
    <span class="series p-category astro-WMBV4WGB"></span>
    <h1 class="title p-name astro-WMBV4WGB">
      倒排索引<a class="u-url astro-WMBV4WGB" href="/cninverted-index"></a>
    </h1>
    <time class="astro-WMBV4WGB">2019/08/27</time>

    <summary class="p-summary astro-WMBV4WGB"></summary>

    <section class="main e-content astro-WMBV4WGB">
      <p>世界上最伟大的互联网产品,说是搜索引擎,绝对没有别的产品可以替代,尤其是伟大的先在市场占用率最高的搜索引擎,Google Search.</p>
<p>还有很多差一大截的,比如 Bing, Yahoo 和 YANDEX.</p>
<more></more>
<h2 id="什么是搜索引擎">什么是搜索引擎</h2>
<p>所谓搜索引擎，就是根据用户需求与一定算法，运用特定策略从互联网检索出制定信息反馈给用户的一门检索技术。</p>
<p>搜索引擎技术的核心模块一般包括爬虫、索引、检索和排序等，同时可添加其他一系列辅助模块，以为用户创造更好的网络使用环境。</p>
<h2 id="搜索引擎干了些什么">搜索引擎干了些什么</h2>
<p>简单的说搜索引擎从网络上爬取网页,然后对网页信息进行提取,构建正排索引,然后分析网页内容,建立倒排文件.</p>
<p>接下来我将依次介绍 正排索引、 倒排索引 等知识点.</p>
<h2 id="正排索引">正排索引</h2>
<p>正排索引通常是
id-document 的键值对</p>





























<table><thead><tr><th>id</th><th>name</th><th>context</th><th>eng_context</th></tr></thead><tbody><tr><td>1</td><td>小明</td><td>今天吃了 3 个包子</td><td>today eating 3 baozi</td></tr><tr><td>2</td><td>小仓</td><td>最后一天看了一本书</td><td>read a book last day</td></tr><tr><td>3</td><td>仓颉</td><td>去年造了个新华字典</td><td>make a xinhua dictionary last year</td></tr></tbody></table>
<h2 id="倒排索引">倒排索引</h2>
<p>倒排索引是关键词到 id 列表的映射关系.</p>
<p>倒排索引里面左边的列叫做 term , 里面存储的通常是一个关键词;
右边的列叫做 posting list,里面存储的是文档的 id.</p>
<p>左侧的一列一起叫做 term dictionary.</p>
<p>首先上面有每个 document 有 3 个 field , 所以会创建 3 个倒排索引.</p>
<p>如果使用默认的英文分词器,那么表格会创建的索引大概是下面这个样子:</p>
<p>name index:</p>

























<table><thead><tr><th>term</th><th>posting list</th></tr></thead><tbody><tr><td>小</td><td>[1, 2]</td></tr><tr><td>仓</td><td>[2, 3]</td></tr><tr><td>明</td><td>[1]</td></tr><tr><td>颉</td><td>[3]</td></tr></tbody></table>
<p>context index:</p>

























<table><thead><tr><th>term</th><th>posting list</th></tr></thead><tbody><tr><td>个</td><td>[1, 3]</td></tr><tr><td>了</td><td>[1, 2, 3]</td></tr><tr><td>今</td><td>[1]</td></tr><tr><td>…</td><td>…</td></tr></tbody></table>
<p>eng_context index:</p>

























<table><thead><tr><th>term</th><th>posting list</th></tr></thead><tbody><tr><td>last</td><td>[2, 3]</td></tr><tr><td>a</td><td>[2, 3]</td></tr><tr><td>dictionary</td><td>[3]</td></tr><tr><td>…</td><td>…</td></tr></tbody></table>
<hr/>
<p>读到这里想来你也会有些许疑问?</p>
<ul>
<li>比 MySQL Index 的优势在哪?</li>
<li>当有 1 亿 Term 时如何高效查询?</li>
<li>联合查询怎么办?</li>
<li>相关度排序?</li>
</ul>
<h2 id="term-index">Term index</h2>
<p>假象一下我们现在有 1 亿个 term, 那么这个 trem dictionary 会占多少内存呢?
假设每个 trem 占用内存 6 byte, 那么亿个大约占用 0.6 GB, 那么如果是一个非常复杂的文档, 岂不是内存不够用?
而且为什么搜索引擎的速度远远快于 MySQL 的索引速度?</p>
<p>首先 Trem Index 实际上是一种字典树(前缀树), 可以将 term dictionary 里的内容组成树状结构.
下图会是一个普通的字典树.
<img src="media/15669198838069/15673442795943.jpg" alt=""/></p>
<p>而 Term Index 的 Value 就是 Term 在磁盘中的位置.</p>
<p>而且 Trem Index 通常会被缓存到内存中, 再加上优秀的树结构, 所以查询速度极快, 字典树的数据结构优势, 使体积远小于 term dictonary.</p>
<p>快于 MySQL 的主要原因是, 减少了访问磁盘的次数.MySQL 的 B+树会在磁盘中多次读写不同位置, 而使用 term index , 则只会在匹配到 term 时进行一次磁盘访问.</p>
<h2 id="联合查询">联合查询</h2>
<p>如何进行索引的联合查询, 当程序获得多个 Posting list 那么程序需要从 list 中进行多次交集并集操作.如何减少这些操作呢?</p>
<p>通常有两个解决方案.</p>
<ul>
<li>bitset</li>
<li>跳表</li>
</ul>
<p>可以自己去看一下相关的工作原理。</p>
<h2 id="end">END</h2>
<p>想必看完之后，你也对倒排索引工作原理有一定的了解了吧。感谢阅读！</p>
    </section>
  </article>
  </div>
    <footer class="astro-SZ7XMLTE">
  <span class="webring astro-MTZRIXCV">
  <a href="https://xn--sr8hvo.ws/%F0%9F%95%90%F0%9F%89%91%F0%9F%88%B6/previous" class="astro-MTZRIXCV">←</a> An IndieWeb Webring 🕸💍 <a href="https://xn--sr8hvo.ws/%F0%9F%95%90%F0%9F%89%91%F0%9F%88%B6/next" class="astro-MTZRIXCV">→</a>
</span>
  <span class="astro-SZ7XMLTE">EINDEX @ 2023</span>
</footer>
    <script async defer data-website-id="d963565f-c209-41a4-98d2-faac7625f470" src="https://umami.eindex.me/umami.js"></script>
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;01180ed57cc34c3896e21f5c09a75ef5&quot;}"></script>
    
  </body>
</html>