<!DOCTYPE html>
<html lang="en" class="astro-SCKKX6R4">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" href="/favicon.ico">
    <meta name="generator" content="Astro v2.0.15">
    <title>KMP 算法</title>
    <link rel="webmention" href="https://webmention.io/eindex.me/webmention">
    <link rel="pingback" href="https://webmention.io/eindex.me/xmlrpc">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/lxgwwenkai-regular.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link href="https://{{cdn}}/prismjs@v1.x/themes/prism.css" rel="stylesheet">
    <link rel="stylesheet" href="/katex.min.css" crossorigin="anonymous">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SR36ZS0R52"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-SR36ZS0R52");
</script>
  <link rel="stylesheet" href="/_astro/gallery.197e1a52.css" />
<link rel="stylesheet" href="/_astro/_slug_.9be3c881.css" />
<link rel="stylesheet" href="/_astro/_slug_.8ced6fc2.css" /><script type="module">class o extends HTMLElement{constructor(){super();const e=this.querySelector("button"),t=this.querySelector("div.code-body");e.addEventListener("click",()=>{navigator.clipboard.writeText(t.innerText).then(()=>{console.log("copy successd")})})}}customElements.define("article-code",o);
</script></head>
  <body class="astro-SCKKX6R4">
    <div class="blog astro-SCKKX6R4">
      <nav class="astro-5BLMO7YK">
  <span class="astro-5BLMO7YK"><img width="32px" height="32px" src="/images/avatar.png" class="astro-5BLMO7YK"><a href="/" class="astro-5BLMO7YK">EINDEX's Blog</a></span>
  <ul class="astro-5BLMO7YK">
    <li class="astro-5BLMO7YK"><a rel="me" href="https://github.com/eindex" class="astro-5BLMO7YK">Github</a></li>
    <li class="astro-5BLMO7YK"><a rel="me" href="https://twitter.com/@eindex_li" class="astro-5BLMO7YK">Twitter</a></li>
  </ul>
</nav>
      <article class="h-entry astro-WMBV4WGB">
    <span class="series p-category astro-WMBV4WGB"></span>
    <h1 class="title p-name astro-WMBV4WGB">
      KMP 算法<a class="u-url astro-WMBV4WGB" href="/cnkmp"></a>
    </h1>
    <time class="astro-WMBV4WGB">2018/05/11</time>

    <summary class="p-summary astro-WMBV4WGB"></summary>

    <section class="main e-content astro-WMBV4WGB">
      <blockquote>
<p>在计算机科学中，Knuth-Morris-Pratt 字符串查找算法（简称为 KMP 算法）可在一个主文本字符串 S 内查找一个词 W 的出现位置。此算法通过运用对这个词在不匹配时本身就包含足够的信息来确定下一个匹配将在哪里开始的发现，从而避免重新检查先前匹配的字符。</p>
</blockquote>

<blockquote>
<p>这个算法是由高德纳（Donald Ervin Knuth）和沃恩·普拉特在 1974 年构思，同年詹姆斯·H·莫里斯也独立地设计出该算法，最终由三人于 1977 年联合发表。</p>
</blockquote>
<h2 id="原理">原理</h2>
<p>将待匹配字符串命名为 m 源字符串命名为 S 。
本算法对待匹配字符串做处理之后，找到他的真前缀和真后缀。并通过真前缀与后缀重合的数量的值，这个值是在匹配状态中发生矢配时，位于原始字符串上 S 的指针移动的方向与距离。</p>
<p>简单的说就是匹配失败时。通过之前的真前缀和后缀表，直接移动在匹配字符串上的指针，达到减少无用匹配的效果。</p>
<h2 id="优点">优点</h2>
<p>节约时间，相比于朴素的匹配方式，新的匹配算法只需要 O(m + n)的时间复杂度 和 额外 O(m)的空间，这个空间是用来保存真前缀和真后缀的结果的。</p>
<h2 id="实现">实现</h2>
<p>KMP 匹配的关键在于初始化匹配字符串。</p>
<article-code class="astro-VKVMCQTA">
  <div class="code-header astro-VKVMCQTA">
    <span class="astro-VKVMCQTA">python</span><button class="astro-VKVMCQTA">Copy<svg viewBox="0 0 20 20" class="astro-VKVMCQTA" astro-icon="uiw:copy"><path fill="currentColor" d="M6.644 2.983a.252.252 0 0 0-.253.252c0 .139.113.251.253.251h3.713c.14 0 .253-.112.253-.251a.252.252 0 0 0-.253-.252H6.644zm3.713-1.342c.734 0 1.353.49 1.544 1.16l2.175.001c.621.004 1.122.205 1.432.638.266.372.372.85.345 1.387L15.85 17.84c.042.552-.062 1.04-.328 1.445-.312.473-.821.71-1.452.716H3.14c-.76-.03-1.323-.209-1.675-.609-.327-.371-.47-.88-.464-1.5V4.84c-.013-.6.154-1.106.518-1.48.376-.384.932-.554 1.647-.559h1.935c.19-.67.809-1.16 1.543-1.16h3.713zm0 3.187H6.644c-.546 0-1.027-.27-1.317-.684H3.17c-.383.002-.602.07-.682.152-.091.093-.144.252-.138.531v13.07c-.003.325.052.522.13.61.054.061.286.135.685.151h10.9c.2-.002.28-.04.326-.109.091-.138.133-.334.11-.658l.001-13.096c.014-.293-.027-.482-.096-.578-.026-.035-.116-.072-.336-.073h-2.397c-.29.414-.771.684-1.317.684zM17.2 0c.994 0 1.8.801 1.8 1.79v14.082c0 .988-.806 1.79-1.8 1.79h-1.958v-1.343h1.957c.249 0 .45-.2.45-.447V1.789a.449.449 0 0 0-.45-.447H9.643c-.248 0-.45.2-.45.447v.157h-1.35v-.157C7.843.801 8.649 0 9.643 0H17.2zM8.196 11.751c.373 0 .675.3.675.671 0 .37-.302.671-.675.671H4.145a.673.673 0 0 1-.676-.67c0-.371.303-.672.676-.672h4.051zm4.052-2.684c.372 0 .675.3.675.671 0 .37-.303.671-.675.671H4.145a.673.673 0 0 1-.676-.67c0-.371.303-.672.676-.672h8.103zm0-2.684c.372 0 .675.3.675.671a.673.673 0 0 1-.675.671H4.145a.673.673 0 0 1-.676-.67c0-.371.303-.672.676-.672h8.103z"/></svg></button>
  </div>
  <div class="code-body astro-VKVMCQTA"><pre class="shiki " style="background-color: none" tabindex="0"><code><span class="line"><span style="color: #66D9EF; font-style: italic">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">partial_table</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F; font-style: italic">pattern</span><span style="color: #F8F8F2">:</span><span style="color: #66D9EF; font-style: italic">str</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #E6DB74">    当字符串长度为1的时候，不需要进行查表，直接循环匹配时间复杂度就是 O(n)</span></span>
<span class="line"><span style="color: #E6DB74">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #F8F8F2">    front </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> [pattern[:x</span><span style="color: #F92672">+</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">] </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> x </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">range</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(pattern))]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #66D9EF; font-style: italic">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">cal_table_val</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F; font-style: italic">sub_pattern</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">max</span><span style="color: #F8F8F2">([</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">]</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">[</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(front[:i]) </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">range</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(sub_pattern)) </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> sub_pattern[</span><span style="color: #F92672">-</span><span style="color: #F8F8F2">i:] </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> front[:i]])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> [cal_table_val(pattern[:i </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]) </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">range</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(pattern))]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF; font-style: italic">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">kmp</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F; font-style: italic">pattern</span><span style="color: #F8F8F2">, </span><span style="color: #FD971F; font-style: italic">string</span><span style="color: #F8F8F2">, </span><span style="color: #FD971F; font-style: italic">first</span><span style="color: #F92672">=</span><span style="color: #AE81FF">True</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">not</span><span style="color: #F8F8F2"> pattern </span><span style="color: #F92672">or</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">not</span><span style="color: #F8F8F2"> string:</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    res </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> []</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F"># 匹配字符串长度为1 不需要建表</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(pattern) </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i, k </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">enumerate</span><span style="color: #F8F8F2">(string):</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> k </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> pattern:</span></span>
<span class="line"><span style="color: #F8F8F2">                </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> first:</span></span>
<span class="line"><span style="color: #F8F8F2">                    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> i</span></span>
<span class="line"><span style="color: #F8F8F2">                res.append(i)</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> res</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    pt </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> partial_table(pattern)</span></span>
<span class="line"><span style="color: #F8F8F2">    i, j </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">, </span><span style="color: #AE81FF">0</span></span>
<span class="line"><span style="color: #F8F8F2">    lp, ls </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(pattern), </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(string)</span></span>
<span class="line"><span style="color: #F8F8F2">    compile_flag </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">False</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">while</span><span style="color: #F8F8F2"> j </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">&lt;</span><span style="color: #F8F8F2"> ls </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> lp:</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> string[j] </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> pattern[i]:</span></span>
<span class="line"><span style="color: #F8F8F2">            i </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span></span>
<span class="line"><span style="color: #F8F8F2">            j </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span></span>
<span class="line"><span style="color: #F8F8F2">            compile_flag </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">True</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(pattern):</span></span>
<span class="line"><span style="color: #F8F8F2">                </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> first:</span></span>
<span class="line"><span style="color: #F8F8F2">                    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> j </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> i</span></span>
<span class="line"><span style="color: #F8F8F2">                res.append(j </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> i)</span></span>
<span class="line"><span style="color: #F8F8F2">                i </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">elif</span><span style="color: #F8F8F2"> string[j] </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> pattern[i] </span><span style="color: #F92672">and</span><span style="color: #F8F8F2"> compile_flag:</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #88846F"># 之前为匹配状态 需要移动匹配数组指针</span></span>
<span class="line"><span style="color: #F8F8F2">            compile_flag </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">False</span></span>
<span class="line"><span style="color: #F8F8F2">            i </span><span style="color: #F92672">-=</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> pt[i</span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">elif</span><span style="color: #F8F8F2"> string[j] </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> pattern[i] </span><span style="color: #F92672">and</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">not</span><span style="color: #F8F8F2"> compile_flag:</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #88846F"># 之前为不匹配状态 匹配指针归 0</span></span>
<span class="line"><span style="color: #F8F8F2">            i </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span></span>
<span class="line"><span style="color: #F8F8F2">            j </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> res</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">partial_table(</span><span style="color: #E6DB74">&#39;ABCDABD&#39;</span><span style="color: #F8F8F2">) </span><span style="color: #88846F"># [0, 0, 0, 0, 1, 2, 0]</span></span>
<span class="line"><span style="color: #F8F8F2">kmp(</span><span style="color: #E6DB74">&#39;ABCDABD&#39;</span><span style="color: #F8F8F2">,</span><span style="color: #E6DB74">&#39;BBC ABCDAB ABCDABCDABDE&#39;</span><span style="color: #F8F8F2">) </span><span style="color: #88846F"># 15</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre></div>

  

  
</article-code>
    </section>
  </article>
      <footer class="astro-SZ7XMLTE">  
  <span class="webring astro-MTZRIXCV"> <a href="https://xn--sr8hvo.ws/%F0%9F%95%90%F0%9F%89%91%F0%9F%88%B6/previous" class="astro-MTZRIXCV">←</a> An IndieWeb Webring 🕸💍 <a href="https://xn--sr8hvo.ws/%F0%9F%95%90%F0%9F%89%91%F0%9F%88%B6/next" class="astro-MTZRIXCV">→</a> </span>
  <span class="astro-SZ7XMLTE">EINDEX @ 2023</span>
</footer>
    </div>
    <script async defer data-website-id="d963565f-c209-41a4-98d2-faac7625f470" src="https://umami.eindex.me/umami.js"></script>
  

</body></html>