<!doctype html><html charset=utf-8 lang=en><head><link href=https://eindex.me/cn/feed.xml rel=alternate title=RSS type=application/rss+xml><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=EINDEX itemprop=author name=author><title>KMP 算法 • EINDEX's Blog</title><meta content="KMP 算法 • EINDEX's Blog" property=og:title><meta charset=utf-8><link href="https://eindex.me/css/index.css?h=ccea0507d7a144ac853b15d9faf3870cd191005acbb1e1ff638fef578e3a76eb" rel=stylesheet><style>@-moz-document url-prefix() {.lazy:-moz-loading {visibility:hidden;}}.ieOnly {display: none;}@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {.ieOnly {display: block;}}</style><link href=https://webmention.io/eindex.me/webmention rel=webmention><link href=https://webmention.io/eindex.me/xmlrpc rel=pingback><script src=https://cdn.jsdelivr.net/npm/iconify-icon@1.0.1/dist/iconify-icon.min.js></script><link href=/favicon-512.png rel=apple-touch-icon sizes=512x512><link href=/favicon-512.png rel=icon sizes=512x512 type=image/png><link href=/favicon-192.png rel=icon sizes=192x192 type=image/png><link href=/manifest.json rel=manifest><meta content=https://eindex.me/cn/posts/kmp/ property=og:url><meta content="EINDEX's Blog" property=og:site_name><meta content=https://eindex.me/images/avatar.png property=og:image><meta content=summary name=twitter:card><meta content="KMP 算法" name=twitter:title><meta content=@eindex_li name=twitter:site><meta content=@eindex_li name=twitter:creator><meta content=https://eindex.me/images/avatar.png name=twitter:image><script type=application/ld+json>
{
  "@context": "https://schema.org/",
  "@type": "BlogPosting",
  "headline": "KMP 算法",
  "image": "https://eindex.me/images/avatar.png",
  
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://eindex.me/cn/posts/kmp/"
  },
  
  "datePublished": "2018-05-11",
  
  
  "author": {
    "@type": "Person",
    "name": "EINDEX",
    "url": "https://eindex.me/about"
  },
  "publisher": {
    "@type": "Organization",
    "name": "EINDEX's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://eindex.me/images/avatar.png"
    }
  },
  "keywords": ["algorithm","KMP","Python"]
}
</script><script src="https://www.googletagmanager.com/gtag/js?id=G-SR36ZS0R52" async></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SR36ZS0R52');</script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1265138627025369" async crossorigin=anonymous></script><body><div class=all><header><nav class=navbar><div class=avatar><a class=site-link href=https://eindex.me/cn/><img alt=Workflow class=avatar src=https://eindex.me/processed_images/e75389feba7c019600.png></a></div><div class=menus><a href=https://eindex.me/cn/gallery/>相册</a><a href=https://eindex.me/cn/archive/>归档</a></div><div class=switcher><a class="language switch" href=https://eindex.me/><iconify-icon icon=ri:english-input></iconify-icon></a></div></nav></header><div class=content><main><article class=h-entry data-clarity-region=article><section class=header><section class=title-area><a class="series p-category" href=https://eindex.me/cn/series/algorithm/>Algorithm</a><h1 class="title p-name"><a class=u-url href=https://eindex.me/cn/posts/kmp/>KMP 算法</a></h1></section><section class=meta-area><p style="display: none;" class=p-summary>&LTblockquote> &LTp>在计算机科学中，Knuth-Morris-Pratt字符串查找算法（简称为KMP算法）可在一个主文本字符串S内查找一个词W的出现位置。此算法通过运用对这个词在不匹配时本身就包含足够的信息来确定下一个匹配将在哪里开始的发现，从而避免重新检查先前匹配的字符。&LT/p> &LT/blockquote></p><span><iconify-icon icon=ant-design:calendar-outlined></iconify-icon> <time class=dt-published>2018-05-11</time></span><span><iconify-icon icon=bx:time-five></iconify-icon> 4 mins</span></section></section><div class="p-author h-card" style="display: none;"><img class="u-logo u-photo" src=https://eindex.me/images/avatar.png><a class="p-nickname p-name u-url" href=https://eindex.me>EINDEX</a><p class=p-note>My goal is make happy.</div><section class="main e-content"><blockquote><p>在计算机科学中，Knuth-Morris-Pratt字符串查找算法（简称为KMP算法）可在一个主文本字符串S内查找一个词W的出现位置。此算法通过运用对这个词在不匹配时本身就包含足够的信息来确定下一个匹配将在哪里开始的发现，从而避免重新检查先前匹配的字符。</blockquote><span id=continue-reading></span><blockquote><p>这个算法是由高德纳（Donald Ervin Knuth）和沃恩·普拉特在1974年构思，同年詹姆斯·H·莫里斯也独立地设计出该算法，最终由三人于1977年联合发表。</blockquote><h2 id=yuan-li>原理</h2><p>将待匹配字符串命名为 m 源字符串命名为 S 。 本算法对待匹配字符串做处理之后，找到他的真前缀和真后缀。并通过真前缀与后缀重合的数量的值，这个值是在匹配状态中发生矢配时，位于原始字符串上 S 的指针移动的方向与距离。<p>简单的说就是匹配失败时。通过之前的真前缀和后缀表，直接移动在匹配字符串上的指针，达到减少无用匹配的效果。<h2 id=you-dian>优点</h2><p>节约时间，相比于朴素的匹配方式，新的匹配算法只需要 O(m + n)的时间复杂度 和 额外 O(m)的空间，这个空间是用来保存真前缀和真后缀的结果的。<h2 id=shi-xian>实现</h2><p>KMP 匹配的关键在于初始化匹配字符串。<pre class=language-python data-lang=python style=background-color:#272822;color:#f8f8f2;><code class=language-python data-lang=python><span style=font-style:italic;color:#f92672;>def </span><span style=color:#a6e22e;>partial_table</span><span>(</span><span style=font-style:italic;color:#fd971f;>pattern</span><span>:</span><span style=font-style:italic;color:#66d9ef;>str</span><span>):
</span><span>    </span><span style=color:#75715e;>"""
</span><span style=color:#75715e;>    当字符串长度为1的时候，不需要进行查表，直接循环匹配时间复杂度就是 O(n)
</span><span style=color:#75715e;>    """
</span><span>    front </span><span style=color:#f92672;>= </span><span>[pattern[:x</span><span style=color:#f92672;>+</span><span style=color:#ae81ff;>1</span><span>] </span><span style=color:#f92672;>for </span><span>x </span><span style=color:#f92672;>in </span><span style=color:#66d9ef;>range</span><span>(</span><span style=color:#66d9ef;>len</span><span>(pattern))]
</span><span>
</span><span>    </span><span style=font-style:italic;color:#f92672;>def </span><span style=color:#a6e22e;>cal_table_val</span><span>(</span><span style=font-style:italic;color:#fd971f;>sub_pattern</span><span>):
</span><span>        </span><span style=color:#f92672;>return </span><span style=color:#66d9ef;>max</span><span>([</span><span style=color:#ae81ff;>0</span><span>]</span><span style=color:#f92672;>+</span><span>[</span><span style=color:#66d9ef;>len</span><span>(front[:i]) </span><span style=color:#f92672;>for </span><span>i </span><span style=color:#f92672;>in </span><span style=color:#66d9ef;>range</span><span>(</span><span style=color:#66d9ef;>len</span><span>(sub_pattern)) </span><span style=color:#f92672;>if </span><span>sub_pattern[</span><span style=color:#f92672;>-</span><span>i:] </span><span style=color:#f92672;>in </span><span>front[:i]])
</span><span>
</span><span>    </span><span style=color:#f92672;>return </span><span>[cal_table_val(pattern[:i </span><span style=color:#f92672;>+ </span><span style=color:#ae81ff;>1</span><span>]) </span><span style=color:#f92672;>for </span><span>i </span><span style=color:#f92672;>in </span><span style=color:#66d9ef;>range</span><span>(</span><span style=color:#66d9ef;>len</span><span>(pattern))]
</span><span>
</span><span>
</span><span style=font-style:italic;color:#f92672;>def </span><span style=color:#a6e22e;>kmp</span><span>(</span><span style=font-style:italic;color:#fd971f;>pattern</span><span>, </span><span style=font-style:italic;color:#fd971f;>string</span><span>, </span><span style=font-style:italic;color:#fd971f;>first</span><span style=color:#f92672;>=</span><span style=color:#ae81ff;>True</span><span>):
</span><span>    </span><span style=color:#f92672;>if not </span><span>pattern </span><span style=color:#f92672;>or not </span><span>string:
</span><span>        </span><span style=color:#f92672;>return -</span><span style=color:#ae81ff;>1
</span><span>    
</span><span>    res </span><span style=color:#f92672;>= </span><span>[]
</span><span>    </span><span style=color:#75715e;># 匹配字符串长度为1 不需要建表
</span><span>    </span><span style=color:#f92672;>if </span><span style=color:#66d9ef;>len</span><span>(pattern) </span><span style=color:#f92672;>== </span><span style=color:#ae81ff;>1</span><span>:
</span><span>        </span><span style=color:#f92672;>for </span><span>i, k </span><span style=color:#f92672;>in </span><span style=color:#66d9ef;>enumerate</span><span>(string):
</span><span>            </span><span style=color:#f92672;>if </span><span>k </span><span style=color:#f92672;>== </span><span>pattern:
</span><span>                </span><span style=color:#f92672;>if </span><span>first:
</span><span>                    </span><span style=color:#f92672;>return </span><span>i
</span><span>                res.append(i)
</span><span>        </span><span style=color:#f92672;>return </span><span>res
</span><span>
</span><span>    pt </span><span style=color:#f92672;>= </span><span>partial_table(pattern)
</span><span>    i, j </span><span style=color:#f92672;>= </span><span style=color:#ae81ff;>0</span><span>, </span><span style=color:#ae81ff;>0
</span><span>    lp, ls </span><span style=color:#f92672;>= </span><span style=color:#66d9ef;>len</span><span>(pattern), </span><span style=color:#66d9ef;>len</span><span>(string)
</span><span>    compile_flag </span><span style=color:#f92672;>= </span><span style=color:#ae81ff;>False
</span><span>    </span><span style=color:#f92672;>while </span><span>j </span><span style=color:#f92672;>- </span><span>i </span><span style=color:#f92672;>< </span><span>ls </span><span style=color:#f92672;>- </span><span>lp:
</span><span>        </span><span style=color:#f92672;>if </span><span>string[j] </span><span style=color:#f92672;>== </span><span>pattern[i]:
</span><span>            i </span><span style=color:#f92672;>+= </span><span style=color:#ae81ff;>1
</span><span>            j </span><span style=color:#f92672;>+= </span><span style=color:#ae81ff;>1          
</span><span>            compile_flag </span><span style=color:#f92672;>= </span><span style=color:#ae81ff;>True
</span><span>            </span><span style=color:#f92672;>if </span><span>i </span><span style=color:#f92672;>== </span><span style=color:#66d9ef;>len</span><span>(pattern):
</span><span>                </span><span style=color:#f92672;>if </span><span>first:
</span><span>                    </span><span style=color:#f92672;>return </span><span>j </span><span style=color:#f92672;>- </span><span>i
</span><span>                res.append(j </span><span style=color:#f92672;>- </span><span>i)
</span><span>                i </span><span style=color:#f92672;>= </span><span style=color:#ae81ff;>0
</span><span>        </span><span style=color:#f92672;>elif </span><span>string[j] </span><span style=color:#f92672;>!= </span><span>pattern[i] </span><span style=color:#f92672;>and </span><span>compile_flag:
</span><span>            </span><span style=color:#75715e;># 之前为匹配状态 需要移动匹配数组指针
</span><span>            compile_flag </span><span style=color:#f92672;>= </span><span style=color:#ae81ff;>False
</span><span>            i </span><span style=color:#f92672;>-= </span><span>i </span><span style=color:#f92672;>- </span><span>pt[i</span><span style=color:#f92672;>-</span><span style=color:#ae81ff;>1</span><span>]
</span><span>        </span><span style=color:#f92672;>elif </span><span>string[j] </span><span style=color:#f92672;>!= </span><span>pattern[i] </span><span style=color:#f92672;>and not </span><span>compile_flag:
</span><span>            </span><span style=color:#75715e;># 之前为不匹配状态 匹配指针归 0 
</span><span>            i </span><span style=color:#f92672;>= </span><span style=color:#ae81ff;>0
</span><span>            j </span><span style=color:#f92672;>+= </span><span style=color:#ae81ff;>1
</span><span>
</span><span>    </span><span style=color:#f92672;>return </span><span>res
</span><span>
</span><span>partial_table(</span><span style=color:#e6db74;>'ABCDABD'</span><span>) </span><span style=color:#75715e;># [0, 0, 0, 0, 1, 2, 0]
</span><span>kmp(</span><span style=color:#e6db74;>'ABCDABD'</span><span>,</span><span style=color:#e6db74;>'BBC ABCDAB ABCDABCDABDE'</span><span>) </span><span style=color:#75715e;># 15
</span><span>
</span><span>
</span></code></pre></section><section class=post-footer><div class=tags><span class=tag><a href=https://eindex.me/cn/tags/kmp/>KMP</a></span><span class=tag><a href=https://eindex.me/cn/tags/python/>Python</a></span></div></section><hr><section class=webmentions><h2>Response</h2><p class=how-to-send-webmention>Have you written any responses to this article? If so, please send your article or tweet link below. (Making sure to include the link of this article in the content, learn more about webmentions from <a href=https://indieweb.org/Webmention>here</a>.)<form action=https://webmention.io/eindex.me/webmention class=webmention-form method=post><input name=target type=hidden value=https://eindex.me/cn/posts/kmp/><input placeholder="Your webmention link" name=source><button>Send Webmention</button></form></section></article></main><aside></aside></div><footer class=footer><span class=webring> <a href=https://xn--sr8hvo.ws/%F0%9F%95%90%F0%9F%89%91%F0%9F%88%B6/previous>←</a> An IndieWeb Webring 🕸💍 <a href=https://xn--sr8hvo.ws/%F0%9F%95%90%F0%9F%89%91%F0%9F%88%B6/next>→</a> </span><link href=https://github.com/EINDEX rel=me></footer></div>