


  
  


<!DOCTYPE html>
<html lang="en" charset="utf-8">
  <head>
    

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SR36ZS0R52"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  
  var page_link = new URL(window.location.href);
  gtag('js', new Date());
  gtag('config', 'G-SR36ZS0R52', {
    traffic_type: page_link.searchParams.get("traffic_type")
  });
  gtag('set', {
    traffic_type: page_link.searchParams.get("traffic_type")
  })
  

</script>









  
    
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://eindex.me/cn/feed.xml">
    
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="author" itemprop="author" content="EINDEX">
  
  <title>KMP 算法 &bull; EINDEX&#x27;s Blog</title>
  <meta property="og:title" content="KMP 算法 &bull; EINDEX&#x27;s Blog" />
  

  <!-- Required meta tags -->
  <meta charset="utf-8" />


  <!-- **** BEGINNING, favicons **** -->

  <!-- generics -->

  <!-- iOS -->

  <!-- Android -->

  <!-- Windows 8, IE 10 -->

  <!-- Windows 8.1 and up, IE 11 -->

  <!-- **** CONCLUSION, favicons **** -->

  <!-- CSS/SCSS -->
  <link rel="stylesheet" href="https://eindex.me/css/index.css?h=b94c9aaab34db6e206c8e50c66b697c0be3fa2b7d4985a38d5c03fb5a95facd0" />  <style>@-moz-document url-prefix() {.lazy:-moz-loading {visibility:hidden;}}.ieOnly {display: none;}@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {.ieOnly {display: block;}}</style>


  <link rel="webmention" href="https://webmention.io/eindex.me/webmention" />
  <link rel="pingback" href="https://webmention.io/eindex.me/xmlrpc" />

  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.1/dist/iconify-icon.min.js"></script>
  
  
  <link rel="apple-touch-icon" sizes="512x512" href="/favicon-512.png">
  
  <link rel="icon" type="image/png" sizes="512x512" href="/favicon-512.png">
  
  
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
  
  <link rel="manifest" href="/manifest.json">
  <meta name="twitter:dnt" content="on">
  <meta name="twitter:widgets:csp" content="on">
  



  
    
  
    
  

  
    
  





<meta property="og:url" content="https://eindex.me/cn/posts/kmp/">
<meta property="og:site_name" content="EINDEX&#x27;s Blog">
<meta property="og:image" content="https://eindex.me/images/avatar.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KMP 算法">

<meta name="twitter:site" content="@eindex_li">
<meta name="twitter:creator" content="@eindex_li">
<meta name="twitter:image" content="https://eindex.me/images/avatar.png">
<link
  rel="me"
  href="https://twitter.com/eindex_li">
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "BlogPosting",
  "headline": "KMP 算法",
  "image": "https://eindex.me/images/avatar.png",
  
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://eindex.me/cn/posts/kmp/"
  },
  
  "datePublished": "2018-05-11",
  
  
  "author": {
    "@type": "Person",
    "name": "EINDEX",
    "url": "https://eindex.me/about"
  },
  "publisher": {
    "@type": "Organization",
    "name": "EINDEX's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://eindex.me/images/avatar.png"
    }
  },
  "keywords": ["KMP","Python","algorithm"]
}
</script>

  
  <link
rel="stylesheet"
href="https://cdn.jsdelivr.net/npm/docs-searchbar.js@2.4.1/dist/cdn/docs-searchbar.min.css"
/>
  
  
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1265138627025369"
     crossorigin="anonymous"></script>





    
  </head>
  <body>
    <div class="all">
      <header>
  <nav class="navbar">
    <div class="avatar">
      
      <a class="site-link" href="https://eindex.me/cn/"><img
        class="avatar"
        src="https:&#x2F;&#x2F;eindex.me&#x2F;processed_images&#x2F;e75389feba7c019600.png"
        alt="Workflow"
    /></a>
  </div>
  <div class="menus">
    
    
      <a
        href="https://eindex.me/cn/gallery/"
        >相册</a
      >
    
    
    
      <a
        href="https://eindex.me/cn/archive/"
        >归档</a
      >
    
    
  </div>
    
    <div class="switcher">
      <a class="language switch"href = "https://eindex.me/"><iconify-icon icon="ri:english-input"></iconify-icon></a>
    </div>
  </nav>
</header>


      <div class="content">
          <main>
              
  <article class="h-entry" data-clarity-region="article">
    
<section class="header">
  <section class="title-area">
    
      
      
      
      <a class="series p-category" href="https:&#x2F;&#x2F;eindex.me&#x2F;cn&#x2F;series&#x2F;algorithm&#x2F;">Algorithm</a>
    
    <h1 class="title p-name">
    <a class="u-url" href="https:&#x2F;&#x2F;eindex.me&#x2F;cn&#x2F;posts&#x2F;kmp&#x2F;">KMP 算法</a>
    </h1>
  </section>
  <section class="meta-area">
    <p class="p-summary" style="display: none;">&lt;blockquote&gt;
&lt;p&gt;在计算机科学中，Knuth-Morris-Pratt字符串查找算法（简称为KMP算法）可在一个主文本字符串S内查找一个词W的出现位置。此算法通过运用对这个词在不匹配时本身就包含足够的信息来确定下一个匹配将在哪里开始的发现，从而避免重新检查先前匹配的字符。&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
</p>
  
    <span><iconify-icon icon="ant-design:calendar-outlined"></iconify-icon>&nbsp;<time class="dt-published">2018-05-11</time>&nbsp;</span>
  
    <span><iconify-icon icon="bx:time-five"></iconify-icon>&nbsp;4 mins</span>  
    <span style="display:none"><iconify-icon icon="mdi:eye-outline"></iconify-icon>&nbsp;<span id="pv"></span>&nbsp;views</span>
  </section>
</section>

    <div class="p-author h-card" style="display: none;">
    <img class="u-logo u-photo" src="https://eindex.me/images/avatar.png">
    <a class="p-nickname p-name u-url" href="https://eindex.me">EINDEX</a>
    <p class="p-note">My goal is make happy.</p>
</div>
    
    <section class="main e-content">
        
  <blockquote>
<p>在计算机科学中，Knuth-Morris-Pratt字符串查找算法（简称为KMP算法）可在一个主文本字符串S内查找一个词W的出现位置。此算法通过运用对这个词在不匹配时本身就包含足够的信息来确定下一个匹配将在哪里开始的发现，从而避免重新检查先前匹配的字符。</p>
</blockquote>
<span id="continue-reading"></span>
<blockquote>
<p>这个算法是由高德纳（Donald Ervin Knuth）和沃恩·普拉特在1974年构思，同年詹姆斯·H·莫里斯也独立地设计出该算法，最终由三人于1977年联合发表。</p>
</blockquote>
<h2 id="yuan-li">原理</h2>
<p>将待匹配字符串命名为 m 源字符串命名为 S 。
本算法对待匹配字符串做处理之后，找到他的真前缀和真后缀。并通过真前缀与后缀重合的数量的值，这个值是在匹配状态中发生矢配时，位于原始字符串上 S 的指针移动的方向与距离。</p>
<p>简单的说就是匹配失败时。通过之前的真前缀和后缀表，直接移动在匹配字符串上的指针，达到减少无用匹配的效果。</p>
<h2 id="you-dian">优点</h2>
<p>节约时间，相比于朴素的匹配方式，新的匹配算法只需要 O(m + n)的时间复杂度 和 额外 O(m)的空间，这个空间是用来保存真前缀和真后缀的结果的。</p>
<h2 id="shi-xian">实现</h2>
<p>KMP 匹配的关键在于初始化匹配字符串。</p>
<pre data-lang="python" style="background-color:#272822;color:#f8f8f2;" class="language-python "><code class="language-python" data-lang="python"><span style="font-style:italic;color:#f92672;">def </span><span style="color:#a6e22e;">partial_table</span><span>(</span><span style="font-style:italic;color:#fd971f;">pattern</span><span>:</span><span style="font-style:italic;color:#66d9ef;">str</span><span>):
</span><span>    </span><span style="color:#75715e;">&quot;&quot;&quot;
</span><span style="color:#75715e;">    当字符串长度为1的时候，不需要进行查表，直接循环匹配时间复杂度就是 O(n)
</span><span style="color:#75715e;">    &quot;&quot;&quot;
</span><span>    front </span><span style="color:#f92672;">= </span><span>[pattern[:x</span><span style="color:#f92672;">+</span><span style="color:#ae81ff;">1</span><span>] </span><span style="color:#f92672;">for </span><span>x </span><span style="color:#f92672;">in </span><span style="color:#66d9ef;">range</span><span>(</span><span style="color:#66d9ef;">len</span><span>(pattern))]
</span><span>
</span><span>    </span><span style="font-style:italic;color:#f92672;">def </span><span style="color:#a6e22e;">cal_table_val</span><span>(</span><span style="font-style:italic;color:#fd971f;">sub_pattern</span><span>):
</span><span>        </span><span style="color:#f92672;">return </span><span style="color:#66d9ef;">max</span><span>([</span><span style="color:#ae81ff;">0</span><span>]</span><span style="color:#f92672;">+</span><span>[</span><span style="color:#66d9ef;">len</span><span>(front[:i]) </span><span style="color:#f92672;">for </span><span>i </span><span style="color:#f92672;">in </span><span style="color:#66d9ef;">range</span><span>(</span><span style="color:#66d9ef;">len</span><span>(sub_pattern)) </span><span style="color:#f92672;">if </span><span>sub_pattern[</span><span style="color:#f92672;">-</span><span>i:] </span><span style="color:#f92672;">in </span><span>front[:i]])
</span><span>
</span><span>    </span><span style="color:#f92672;">return </span><span>[cal_table_val(pattern[:i </span><span style="color:#f92672;">+ </span><span style="color:#ae81ff;">1</span><span>]) </span><span style="color:#f92672;">for </span><span>i </span><span style="color:#f92672;">in </span><span style="color:#66d9ef;">range</span><span>(</span><span style="color:#66d9ef;">len</span><span>(pattern))]
</span><span>
</span><span>
</span><span style="font-style:italic;color:#f92672;">def </span><span style="color:#a6e22e;">kmp</span><span>(</span><span style="font-style:italic;color:#fd971f;">pattern</span><span>, </span><span style="font-style:italic;color:#fd971f;">string</span><span>, </span><span style="font-style:italic;color:#fd971f;">first</span><span style="color:#f92672;">=</span><span style="color:#ae81ff;">True</span><span>):
</span><span>    </span><span style="color:#f92672;">if not </span><span>pattern </span><span style="color:#f92672;">or not </span><span>string:
</span><span>        </span><span style="color:#f92672;">return -</span><span style="color:#ae81ff;">1
</span><span>    
</span><span>    res </span><span style="color:#f92672;">= </span><span>[]
</span><span>    </span><span style="color:#75715e;"># 匹配字符串长度为1 不需要建表
</span><span>    </span><span style="color:#f92672;">if </span><span style="color:#66d9ef;">len</span><span>(pattern) </span><span style="color:#f92672;">== </span><span style="color:#ae81ff;">1</span><span>:
</span><span>        </span><span style="color:#f92672;">for </span><span>i, k </span><span style="color:#f92672;">in </span><span style="color:#66d9ef;">enumerate</span><span>(string):
</span><span>            </span><span style="color:#f92672;">if </span><span>k </span><span style="color:#f92672;">== </span><span>pattern:
</span><span>                </span><span style="color:#f92672;">if </span><span>first:
</span><span>                    </span><span style="color:#f92672;">return </span><span>i
</span><span>                res.append(i)
</span><span>        </span><span style="color:#f92672;">return </span><span>res
</span><span>
</span><span>    pt </span><span style="color:#f92672;">= </span><span>partial_table(pattern)
</span><span>    i, j </span><span style="color:#f92672;">= </span><span style="color:#ae81ff;">0</span><span>, </span><span style="color:#ae81ff;">0
</span><span>    lp, ls </span><span style="color:#f92672;">= </span><span style="color:#66d9ef;">len</span><span>(pattern), </span><span style="color:#66d9ef;">len</span><span>(string)
</span><span>    compile_flag </span><span style="color:#f92672;">= </span><span style="color:#ae81ff;">False
</span><span>    </span><span style="color:#f92672;">while </span><span>j </span><span style="color:#f92672;">- </span><span>i </span><span style="color:#f92672;">&lt; </span><span>ls </span><span style="color:#f92672;">- </span><span>lp:
</span><span>        </span><span style="color:#f92672;">if </span><span>string[j] </span><span style="color:#f92672;">== </span><span>pattern[i]:
</span><span>            i </span><span style="color:#f92672;">+= </span><span style="color:#ae81ff;">1
</span><span>            j </span><span style="color:#f92672;">+= </span><span style="color:#ae81ff;">1          
</span><span>            compile_flag </span><span style="color:#f92672;">= </span><span style="color:#ae81ff;">True
</span><span>            </span><span style="color:#f92672;">if </span><span>i </span><span style="color:#f92672;">== </span><span style="color:#66d9ef;">len</span><span>(pattern):
</span><span>                </span><span style="color:#f92672;">if </span><span>first:
</span><span>                    </span><span style="color:#f92672;">return </span><span>j </span><span style="color:#f92672;">- </span><span>i
</span><span>                res.append(j </span><span style="color:#f92672;">- </span><span>i)
</span><span>                i </span><span style="color:#f92672;">= </span><span style="color:#ae81ff;">0
</span><span>        </span><span style="color:#f92672;">elif </span><span>string[j] </span><span style="color:#f92672;">!= </span><span>pattern[i] </span><span style="color:#f92672;">and </span><span>compile_flag:
</span><span>            </span><span style="color:#75715e;"># 之前为匹配状态 需要移动匹配数组指针
</span><span>            compile_flag </span><span style="color:#f92672;">= </span><span style="color:#ae81ff;">False
</span><span>            i </span><span style="color:#f92672;">-= </span><span>i </span><span style="color:#f92672;">- </span><span>pt[i</span><span style="color:#f92672;">-</span><span style="color:#ae81ff;">1</span><span>]
</span><span>        </span><span style="color:#f92672;">elif </span><span>string[j] </span><span style="color:#f92672;">!= </span><span>pattern[i] </span><span style="color:#f92672;">and not </span><span>compile_flag:
</span><span>            </span><span style="color:#75715e;"># 之前为不匹配状态 匹配指针归 0 
</span><span>            i </span><span style="color:#f92672;">= </span><span style="color:#ae81ff;">0
</span><span>            j </span><span style="color:#f92672;">+= </span><span style="color:#ae81ff;">1
</span><span>
</span><span>    </span><span style="color:#f92672;">return </span><span>res
</span><span>
</span><span>partial_table(</span><span style="color:#e6db74;">&#39;ABCDABD&#39;</span><span>) </span><span style="color:#75715e;"># [0, 0, 0, 0, 1, 2, 0]
</span><span>kmp(</span><span style="color:#e6db74;">&#39;ABCDABD&#39;</span><span>,</span><span style="color:#e6db74;">&#39;BBC ABCDAB ABCDABCDABDE&#39;</span><span>) </span><span style="color:#75715e;"># 15
</span><span>
</span><span>
</span></code></pre>


        






    </section>
    <section class="post-footer">
        
<div class="tags">
    
        
        <span class="tag"><a href="https:&#x2F;&#x2F;eindex.me&#x2F;cn&#x2F;tags&#x2F;kmp&#x2F;">KMP</a></span>
    
        
        <span class="tag"><a href="https:&#x2F;&#x2F;eindex.me&#x2F;cn&#x2F;tags&#x2F;python&#x2F;">Python</a></span>
    
</div>

    </section>
    


    




<hr/>
<section class="webmentions">
  <h2>Response</h2>
  <p class="how-to-send-webmention">Have you written any responses to this article? If so, please send your article or tweet link below. (Making sure to include the link of this article in the content, learn more about webmentions from <a href="https://indieweb.org/Webmention">here</a>.)</p>
  <form class="webmention-form" action="https://webmention.io/eindex.me/webmention" method="post">
    <input name="target" type="hidden" value="https:&#x2F;&#x2F;eindex.me&#x2F;cn&#x2F;posts&#x2F;kmp&#x2F;" />
    <input name="source" type="text" placeholder="Your webmention link" />
    <button type="submit">Send Webmention</button>
  </form>
  <p class="how-to-send-webmention"><a class="twitter-share-button" href="https://twitter.com/intent/tweet">Tweet</a> and send response
  
  
    </p>
  
</section>
    
</article>

          </main>
          <aside>
              
<section class="search">
<input type="search" id="search-bar-input" placeholder="Searching..." />
</section>
<section>
    <h3 class="section-title">Series</h3>
    
    
    <p><a href="https:&#x2F;&#x2F;eindex.me&#x2F;series&#x2F;blog-enhance-plan&#x2F;">博客演进计划 (1)</a></p>
    
    <p><a href="https:&#x2F;&#x2F;eindex.me&#x2F;series&#x2F;security&#x2F;">应用安全 (1)</a></p>
    
</section>

<section class="tags">
<h3 class="section-title">Tags</h3>

<div class="tags">
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;webmentions&#x2F;">Webmentions (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;umami&#x2F;">umami (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;static-analysis&#x2F;">Static Analysis (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;semgrep&#x2F;">Semgrep (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;security&#x2F;">Security (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;sast&#x2F;">SAST (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;microformats2&#x2F;">Microformats2 (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;memos&#x2F;">memos (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;meilisearch&#x2F;">meilisearch (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;javascript&#x2F;">JavaScript (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;indie-web&#x2F;">Indie Web (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;github-actions&#x2F;">Github Actions (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;engagement&#x2F;">Engagement (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;devsecops&#x2F;">DevSecOps (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;devops&#x2F;">DevOps (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;connectivity&#x2F;">Connectivity (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;community&#x2F;">Community (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;code-review&#x2F;">Code Review (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;ci&#x2F;">CI (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;build-security-in&#x2F;">Build Security In (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;best-practices&#x2F;">Best Practices (1)</a>,
    
    <a href="https:&#x2F;&#x2F;eindex.me&#x2F;tags&#x2F;beginner-s-guide&#x2F;">Beginner&#x27;s Guide (1)</a>
    
<div>
</section>

<section class="advertisement">
    <h3 class="section-title">Advertisements</h3>
    <ins class="adsbygoogle"
        style="display:inline-block;width:192px;height:500px"
        data-ad-client="ca-pub-1265138627025369"
        data-ad-slot="3472732805"></ins>
</section>
          </aside>
      </div>
      <footer class="footer">
  <span class="webring">
<a href="https://xn--sr8hvo.ws/%F0%9F%95%90%F0%9F%89%91%F0%9F%88%B6/previous">←</a>
An IndieWeb Webring 🕸💍
<a href="https://xn--sr8hvo.ws/%F0%9F%95%90%F0%9F%89%91%F0%9F%88%B6/next">→</a>
</span>
  <link href="https://github.com/eindex" rel="me">
  <span>@2022 EINDEX</span>
</footer>

    </div>
  </body>
  
<script async defer data-website-id="692d9153-7341-4370-b652-60df196f2b31" data-host-url="https://u.eindex.me" data-domains="eindex.me" src="/js/umami.js"></script>
<script>window.twttr = (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
      t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js?omit_script=true";
    fjs.parentNode.insertBefore(js, fjs);
  
    t._e = [];
    t.ready = function(f) {
      t._e.push(f);
    };
  
    return t;
  }(document, "script", "twitter-wjs"));</script>
<script src="https://cdn.jsdelivr.net/npm/docs-searchbar.js@2.4.1/dist/cdn/docs-searchbar.min.js"></script>
<script>
  docsSearchBar({
    hostUrl: "https://meili.eindex.me",
    apiKey: "a39cff5442b90bb926f6408b0b08671eee444599e6d9c44c29bd0adae09a4b86",
    indexUid: "blog",
    inputSelector: '#search-bar-input',
    debug: true, // Set debug to true if you want to inspect the dropdown
  })
</script>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

</body>
  
    <script src="/js/pv-counter.js" async defer></script>

</html>