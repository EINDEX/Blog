{% set link = page.permalink | replace(from=config.base_url, to="") | replace(from="/cn", to="") | trim_end_matches(pat="/") %}
{% set web_mentions_data_path = "webmentions/data" ~ link ~ ".json" %}
{% set web_mentions_data = load_data(path=web_mentions_data_path, required=false) %}
{% if  web_mentions_data %}
{% set_global web_mentions_list = [] %}
{% for key, mention in web_mentions_data %}
{% set_global web_mentions_list = web_mentions_list | concat(with=mention) %}
{% endfor %}
{% endif %}

<hr/>

<section class="webmentions">
  <h2>Webmentions</h2>
  <p class="how-to-send-webmention">How to send web mentions, send webmetions is easy, you can do reply on my POSSE.</p>
  <form class="webmention-form" action="https://webmention.io/eindex.me/webmention" method="post">
    <input name="target" type="hidden" value="{{ page.permalink }}" />
    <input name="source" type="text" placeholder="Your webmention link" />
    <button type="submit">Send Webmention</button>
  </form>
{% if web_mentions_list %}
  {{ macro::reactions(webmentions=web_mentions_list) }}
  {{ macro::comments(webmentions=web_mentions_list, page=page) }}
  {{ macro::mentions(webmentions=web_mentions_list, page=page) }}
{% endif %}
</section>